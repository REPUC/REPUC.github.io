<!-- build time:Thu Dec 18 2025 08:30:17 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"><meta name="renderer" content="webkit"><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon.ico"><link rel="alternate" href="/rss.xml" title="老王的个人博客" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="老王的个人博客" type="application/atom+xml"><link rel="alternate" type="application/json" title="老王的个人博客" href="http://blog.oldwang.site/feed.json"><link rel="preconnect" href="https://s4.zstatic.net"><link rel="preconnect" href="https://at.alicdn.com"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&display=swap&subset=latin,latin-ext" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/app.css?v=0.4.17"><link rel="modulepreload" href="/js/chunk-4YLOF3B3.js"><link rel="modulepreload" href="/js/chunk-SDP6BGX2.js"><link rel="modulepreload" href="/js/chunk-UCYTYISU.js"><link rel="modulepreload" href="/js/chunk-V6FXEIHI.js"><link rel="modulepreload" href="/js/chunk-WIQECBEN.js"><link rel="modulepreload" href="/js/comments-DKC7Y5GS.js"><link rel="modulepreload" href="/js/copy-tex-ZL4GFZLV.js"><link rel="modulepreload" href="/js/post-7YLKT2UA.js"><link rel="modulepreload" href="/js/quicklink-4PB7YN32.js"><link rel="modulepreload" href="/js/search-FODACYHH.js"><link rel="modulepreload" href="/js/siteInit.js"><link rel="modulepreload" href="/js/waline-GMI427H3.js"><link rel="stylesheet" href="/css/comments-5V2DVD2M.css" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/siteInit.css" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/waline-33R7XUCB.css" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="preload" href="assets/beijing.png" as="image" fetchpriority="high"><meta name="keywords" content="ELK"><meta name="description" content="这是一个 LinuxSre 相关的技术播客"><link rel="canonical" href="http://blog.oldwang.site/posts/3192084428.html"><title>03 Elasticsearch 集群</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">03 Elasticsearch 集群</h1><div class="meta"><span class="item" title="创建时间：2025-12-10 00:00:00"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">发表于</span><time itemprop="dateCreated datePublished" datetime="2025-12-10T00:00:00+08:00">2025-12-10</time></span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字数</span><span>20k</span><span class="text">字</span></span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i></span><span class="text">阅读时长</span><span>18 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Jaxx.Wang</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><img src="assets/beijing.png" loading="eager" decoding="async" fetchpriority="high" alt="老王的个人博客"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemlistelement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">首页</a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/ELK/" itemprop="item" rel="index" title="分类于ELK"><span itemprop="name">ELK<meta itemprop="position" content="0"></span></a></span></div><article class="post block" itemscope itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://blog.oldwang.site/posts/3192084428.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.jpg"><meta itemprop="name" content="Jaxx.Wang"><meta itemprop="description" content=", 这是一个 LinuxSre 相关的技术播客"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="老王的个人博客"></span><div class="body md" itemprop="articleBody"><h2 id="1-elasticsearch-集群"><a class="anchor" href="#1-elasticsearch-集群">#</a> 1、ElasticSearch 集群</h2><h3 id="11-es-集群优势"><a class="anchor" href="#11-es-集群优势">#</a> 1.1 ES 集群优势</h3><p>Elasticsearch 集群是由多个节点组成的一个分布式系统。<br>使用 Elasticsearch 集群有以下几个优点：</p><ol><li><strong>扩展性</strong>：Elasticsearch 集群将数据分布在多个节点，也就是可以使用更多的 CPU、内存、磁盘等。从而能够进行大规模的数据存储和处理工作。随着数据不断的增长，可以通过向集群添加更多的节点来应对。这样即使数据量达到 PB 级别，Elasticsearch 集群仍可以正常工作。<br>场景说明：应用程序每天生成数百万条日志。单个服务器可能很快就会被数据量压垮。使用 Elasticsearch 集群后，就可以将数据均匀分布到多个节点上，这样每个节点只需要负责处理一部分的数据，从而实现整体的扩展性，以应对大规模的数据增长。</li><li><strong>数据的容灾</strong>：Elasticsearch 集群通过在多个节点上存储数据的副本，来实现数据的容灾。意味着，如果某个节点发生故障，数据仍然可以从其他节点的副本中快速恢复，无需人工干预，从而减少了业务中断的风险。从而保证了整个集群的正常运行。</li><li><strong>服务的高可用性</strong>：Elasticsearch 集群具有自动检测节点故障的能力。当某个节点发生故障时，集群会将故障节点上的任务快速分配给其他正常运行的节点。这样，即使某个节点发生故障，整个集群仍可以继续正常运行。（用户几乎感觉不到任何影响。）</li></ol><h3 id="12-es-如何组集群"><a class="anchor" href="#12-es-如何组集群">#</a> 1.2 ES 如何组集群</h3><ol><li><p>单节点 ES，如下图所示；</p></li><li><p>如果单节点出现问题，服务就不可用了，新增一个 ES 节点加入集群</p></li></ol><p>Elasticsearch 集群是由多个节点组成的，通过 <code>cluster.name</code> 定义集群名称，然后每个节点通过 <code>node.name</code> 来标识在集群中的名称。<br><code>cluster.name</code> 相同则表示隶属于同一个集群。</p><h2 id="2-es-集群环境部署"><a class="anchor" href="#2-es-集群环境部署">#</a> 2、ES 集群环境部署</h2><h3 id="20-环境地址规划"><a class="anchor" href="#20-环境地址规划">#</a> 2.0 环境地址规划</h3><table><thead><tr><th>系统版本</th><th>主机名称</th><th>IP 地址</th></tr></thead><tbody><tr><td>RockyLinux9 | Ubuntu2204</td><td><a target="_blank" rel="noopener" href="http://kibana.wang.org">kibana.wang.org</a></td><td>192.168.80.150</td></tr><tr><td>RockyLinux9 | Ubuntu2204</td><td><a target="_blank" rel="noopener" href="http://es-node1.wang.org">es-node1.wang.org</a></td><td>192.168.80.151</td></tr><tr><td>RockyLinux9 | Ubuntu2204</td><td><a target="_blank" rel="noopener" href="http://es-node2.wang.org">es-node2.wang.org</a></td><td>192.168.80.152</td></tr><tr><td>RockyLinux9 | Ubuntu2204</td><td><a target="_blank" rel="noopener" href="http://es-node3.wang.org">es-node3.wang.org</a></td><td>192.168.80.153</td></tr></tbody></table><h3 id="21-node1-集群节点配置"><a class="anchor" href="#21-node1-集群节点配置">#</a> 2.1 node1 集群节点配置</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 1、安装 elasticSearch</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@es-node1 ~<span class="token punctuation">]</span><span class="token comment"># yum install java-17-openjdk java-17-openjdk-devel -y</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@es-node1 ~<span class="token punctuation">]</span><span class="token comment"># rpm -ivh elasticsearch-8.18.2-x86_64.rpm</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@es-node1 ~<span class="token punctuation">]</span>$ dpkg <span class="token parameter variable">-i</span> elasticsearch-8.18.2-amd64.deb</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 2、配置 elasticSearch</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>root@es-node1 ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/elasticsearch/elasticsearch.yml</span></pre></td></tr><tr><td data-num="8"></td><td><pre>cluster.name: es-cluster                <span class="token comment"># 集群名称</span></pre></td></tr><tr><td data-num="9"></td><td><pre>node.name: es-node1                     <span class="token comment"># 节点名称</span></pre></td></tr><tr><td data-num="10"></td><td><pre>path.data: /var/lib/elasticsearch       <span class="token comment"># 数据存储路径</span></pre></td></tr><tr><td data-num="11"></td><td><pre>path.logs: /var/log/elasticsearch       <span class="token comment"># 日志存储路径</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># bootstrap.memory_lock: true           # 内存锁定，避免 es 使用 swap</span></pre></td></tr><tr><td data-num="13"></td><td><pre>network.host: <span class="token number">192.168</span>.80.151            <span class="token comment"># 本机 IP 地址，监听在本地哪个地址上</span></pre></td></tr><tr><td data-num="14"></td><td><pre>http.port: <span class="token number">9200</span>                         <span class="token comment"># 监听端口</span></pre></td></tr><tr><td data-num="15"></td><td><pre>discovery.seed_hosts: <span class="token punctuation">[</span><span class="token string">"192.168.80.151"</span>, <span class="token string">"192.168.80.152"</span>, <span class="token string">"192.168.80.153"</span><span class="token punctuation">]</span>  <span class="token comment"># 集群主机列表</span></pre></td></tr><tr><td data-num="16"></td><td><pre>cluster.initial_master_nodes: <span class="token punctuation">[</span><span class="token string">"192.168.80.151"</span>, <span class="token string">"192.168.80.152"</span>, <span class="token string">"192.168.80.153"</span><span class="token punctuation">]</span>  <span class="token comment"># 参与选举的主机，仅第一次启动集群时进行选举 [可以填写 node.name 的名称]</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># 注释如下行重复配置 [重要]</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment"># cluster.initial_master_nodes: ["es-node1.wang.org"]</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment"># 关闭 Security</span></pre></td></tr><tr><td data-num="21"></td><td><pre>xpack.security.enabled: <span class="token boolean">false</span></pre></td></tr><tr><td data-num="22"></td><td><pre>xpack.security.enrollment.enabled: <span class="token boolean">false</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token comment"># 3. 配置 JVM 内存</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">[</span>root@es-node1 ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/elasticsearch/jvm.options</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token parameter variable">-Xms512m</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token parameter variable">-Xmx512m</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token comment"># 4. 重启 ES 服务</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">[</span>root@es-node1 ~<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/log/elasticsearch/*</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">[</span>root@es-node1 ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart elasticsearch</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">[</span>root@es-node1 ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable --now elasticsearch</span></pre></td></tr></table></figure><h3 id="22-node2-集群节点配置"><a class="anchor" href="#22-node2-集群节点配置">#</a> 2.2 node2 集群节点配置</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 1、安装 elasticSearch</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@es-node2 ~<span class="token punctuation">]</span><span class="token comment"># yum install java-17-openjdk java-17-openjdk-devel -y</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@es-node2 ~<span class="token punctuation">]</span><span class="token comment"># rpm -ivh elasticsearch-8.18.2-x86_64.rpm</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@es-node2 ~<span class="token punctuation">]</span>$ dpkg <span class="token parameter variable">-i</span> elasticsearch-8.18.2-amd64.deb</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 2、配置 elasticSearch</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>root@es-node2 ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/elasticsearch/elasticsearch.yml</span></pre></td></tr><tr><td data-num="8"></td><td><pre>cluster.name: es-cluster</pre></td></tr><tr><td data-num="9"></td><td><pre>node.name: es-node2</pre></td></tr><tr><td data-num="10"></td><td><pre>path.data: /var/lib/elasticsearch</pre></td></tr><tr><td data-num="11"></td><td><pre>path.logs: /var/log/elasticsearch</pre></td></tr><tr><td data-num="12"></td><td><pre>network.host: <span class="token number">192.168</span>.80.152            <span class="token comment"># 本机 IP 地址</span></pre></td></tr><tr><td data-num="13"></td><td><pre>discovery.seed_hosts: <span class="token punctuation">[</span><span class="token string">"192.168.80.151"</span>, <span class="token string">"192.168.80.152"</span>, <span class="token string">"192.168.80.153"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="14"></td><td><pre>cluster.initial_master_nodes: <span class="token punctuation">[</span><span class="token string">"192.168.80.151"</span>, <span class="token string">"192.168.80.152"</span>, <span class="token string">"192.168.80.153"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># 注释如下行重复配置 [重要]</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># cluster.initial_master_nodes: ["es-node2.wang.org"]</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment"># 关闭 Security</span></pre></td></tr><tr><td data-num="19"></td><td><pre>xpack.security.enabled: <span class="token boolean">false</span></pre></td></tr><tr><td data-num="20"></td><td><pre>xpack.security.enrollment.enabled: <span class="token boolean">false</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment"># 3. 配置 JVM 内存</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">[</span>root@es-node2 ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/elasticsearch/jvm.options</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token parameter variable">-Xms512m</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token parameter variable">-Xmx512m</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment"># 4. 重启 ES 服务</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">[</span>root@es-node2 ~<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/log/elasticsearch/*</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">[</span>root@es-node2 ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart elasticsearch</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">[</span>root@es-node2 ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable --now elasticsearch</span></pre></td></tr></table></figure><h3 id="23-node3-集群节点配置"><a class="anchor" href="#23-node3-集群节点配置">#</a> 2.3 node3 集群节点配置</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 1、安装 elasticSearch</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@es-node3 ~<span class="token punctuation">]</span><span class="token comment"># yum install java-17-openjdk java-17-openjdk-devel -y</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@es-node3 ~<span class="token punctuation">]</span><span class="token comment"># rpm -ivh elasticsearch-8.18.2-x86_64.rpm</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@es-node3 ~<span class="token punctuation">]</span>$ dpkg <span class="token parameter variable">-i</span> elasticsearch-8.18.2-amd64.deb</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 2、配置 elasticSearch</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>root@es-node3 ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/elasticsearch/elasticsearch.yml</span></pre></td></tr><tr><td data-num="8"></td><td><pre>cluster.name: es-cluster</pre></td></tr><tr><td data-num="9"></td><td><pre>node.name: es-node3</pre></td></tr><tr><td data-num="10"></td><td><pre>path.data: /var/lib/elasticsearch</pre></td></tr><tr><td data-num="11"></td><td><pre>path.logs: /var/log/elasticsearch</pre></td></tr><tr><td data-num="12"></td><td><pre>network.host: <span class="token number">192.168</span>.80.153        <span class="token comment"># 本机 IP 地址</span></pre></td></tr><tr><td data-num="13"></td><td><pre>discovery.seed_hosts: <span class="token punctuation">[</span><span class="token string">"192.168.80.151"</span>, <span class="token string">"192.168.80.152"</span>, <span class="token string">"192.168.80.153"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="14"></td><td><pre>cluster.initial_master_nodes: <span class="token punctuation">[</span><span class="token string">"192.168.80.151"</span>, <span class="token string">"192.168.80.152"</span>, <span class="token string">"192.168.80.153"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># 注释如下行重复配置 [重要]</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># cluster.initial_master_nodes: ["es-node3.wang.org"]</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment"># 关闭 Security</span></pre></td></tr><tr><td data-num="20"></td><td><pre>xpack.security.enabled: <span class="token boolean">false</span></pre></td></tr><tr><td data-num="21"></td><td><pre>xpack.security.enrollment.enabled: <span class="token boolean">false</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment"># 3. 配置 JVM 内存</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">[</span>root@es-node3 ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/elasticsearch/jvm.options</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token parameter variable">-Xms512m</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token parameter variable">-Xmx512m</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token comment"># 4. 重启 ES 服务</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">[</span>root@es-node3 ~<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/log/elasticsearch/*</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">[</span>root@es-node3 ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart elasticsearch</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">[</span>root@es-node3 ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable --now elasticsearch</span></pre></td></tr></table></figure><h2 id="3-es-集群状态检测"><a class="anchor" href="#3-es-集群状态检测">#</a> 3、ES 集群状态检测</h2><h3 id="31-es-集群指标状态"><a class="anchor" href="#31-es-集群指标状态">#</a> 3.1 ES 集群指标状态</h3><p><code>Cluster Health</code> 获取集群的健康状态，整个集群状态包括以下三种：</p><ol><li><strong>green</strong>：健康状态，指所有主副分片都正常分配</li><li><strong>yellow</strong>：所有主分片都正常分配，但是有副本分片未正常分配</li><li><strong>red</strong>：有主分片未分配，也就是索引不完备，写可能有问题。（但不代表不能读取数据）</li></ol><p>检查 ES 集群是否正常运行，可以通过 curl、Cerebro 两种方式。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">curl</span> http://127.0.0.1:9200/_cat/health</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">curl</span> http://127.0.0.1:9200/_cat/nodes?v</pre></td></tr></table></figure><h3 id="32-curl-命令检查集群状态"><a class="anchor" href="#32-curl-命令检查集群状态">#</a> 3.2 Curl 命令检查集群状态</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 1、使用 curl 工具检查 ES 集群状态</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@es-node3 ~<span class="token punctuation">]</span><span class="token comment"># curl http://192.168.80.151:9200/_cluster/health?pretty=true</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token string">"cluster_name"</span> <span class="token builtin class-name">:</span> <span class="token string">"es-cluster"</span>,</pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token string">"status"</span> <span class="token builtin class-name">:</span> <span class="token string">"green"</span>,</pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token string">"timed_out"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token string">"number_of_nodes"</span> <span class="token builtin class-name">:</span> <span class="token number">3</span>,</pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token string">"number_of_data_nodes"</span> <span class="token builtin class-name">:</span> <span class="token number">3</span>,</pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token string">"active_primary_shards"</span> <span class="token builtin class-name">:</span> <span class="token number">36</span>,</pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token string">"active_shards"</span> <span class="token builtin class-name">:</span> <span class="token number">72</span>,</pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token string">"relocating_shards"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token string">"initializing_shards"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token string">"unassigned_shards"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token string">"unassigned_primary_shards"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token string">"delayed_unassigned_shards"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token string">"number_of_pending_tasks"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token string">"number_of_in_flight_fetch"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token string">"task_max_waiting_in_queue_millis"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token string">"active_shards_percent_as_number"</span> <span class="token builtin class-name">:</span> <span class="token number">100.0</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment"># 2、也可以编写脚本监控 ES 集群状态</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token function">curl</span> <span class="token parameter variable">-s</span> http://192.168.80.151:9200/_cluster/health?pretty<span class="token operator">=</span>true <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"status"</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-F</span> <span class="token string">'"'</span> <span class="token string">'&#123;print $4&#125;'</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token comment"># 输出: green</span></pre></td></tr></table></figure><h3 id="33-安装-cerebro-检查集群状态"><a class="anchor" href="#33-安装-cerebro-检查集群状态">#</a> 3.3 安装 Cerebro 检查集群状态</h3><p>cerebro 是可视化工具，用于检查 ES 集群状态。</p><h4 id="rockylinux9-部署-cerebro"><a class="anchor" href="#rockylinux9-部署-cerebro">#</a> RockyLinux9 部署 Cerebro</h4><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 1、安装 java, 它目前仅支持 java1.8 版本</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 并不支持较高的 java 版本，"因此不要与 ES 安装在同一节点上"</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@kibana ~<span class="token punctuation">]</span><span class="token comment"># yum install java-1.8.0-openjdk java-1.8.0-openjdk-devel -y</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 2、安装 Cerebro</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>root@kibana ~<span class="token punctuation">]</span><span class="token comment"># wget https://github.com/lmenezes/cerebro/releases/download/v0.9.4/cerebro-0.9.4-1.noarch.rpm</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>root@kibana ~<span class="token punctuation">]</span><span class="token comment"># rpm -ivh cerebro-0.9.4-1.noarch.rpm</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 3、配置 Cerebro</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">[</span>root@kibana ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/cerebro/application.conf</span></pre></td></tr><tr><td data-num="11"></td><td><pre>data.path: <span class="token string">"/var/lib/cerebro/cerebro.db"</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># data.path = "./cerebro.db"</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment"># 4、启动 Cerebro</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">[</span>root@kibana ~<span class="token punctuation">]</span><span class="token comment"># systemctl start cerebro</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># 查看端口</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">[</span>root@kibana ~<span class="token punctuation">]</span><span class="token comment"># netstat -lntp</span></pre></td></tr><tr><td data-num="19"></td><td><pre>Proto Recv-Q Send-Q Local Address   Foreign Address     State       PID/Program name</pre></td></tr><tr><td data-num="20"></td><td><pre>tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::9000         :::*                LISTEN     <span class="token number">504</span>/java</pre></td></tr></table></figure><h4 id="ubuntu2204-部署-cerebro"><a class="anchor" href="#ubuntu2204-部署-cerebro">#</a> Ubuntu2204 部署 Cerebro</h4><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 可以将其安装在 Kibana 主机</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 依赖 JDK-11</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@ubuntu2204 ~<span class="token punctuation">]</span><span class="token comment"># apt -y install openjdk-11-jdk</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 下载包，官方提供了 DEB 和 RPM 包</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>root@ubuntu2204 ~<span class="token punctuation">]</span><span class="token comment"># wget https://github.com/lmenezes/cerebro/releases/download/v0.9.4/cerebro_0.9.4_all.deb</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 安装</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">[</span>root@ubuntu2204 ~<span class="token punctuation">]</span><span class="token comment"># dpkg -i cerebro_0.9.4_all.deb</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># 启动</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">[</span>root@ubuntu2204 ~<span class="token punctuation">]</span><span class="token comment"># systemctl start cerebro.service</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment"># 默认服务无法启动，端口无法打开</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">[</span>root@ubuntu2204 ~<span class="token punctuation">]</span><span class="token comment"># ss -ntlp | grep 9000</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># 默认无法启动，查看日志，可以看到以下提示，原因是默认 cerebro.db 文件所有目录没有权限导致</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">[</span>root@ubuntu2204 ~<span class="token punctuation">]</span><span class="token comment"># journalctl -u cerebro</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment"># 报错: Caused by: java.sql.SQLException: opening db: './cerebro.db': 权限不够</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment"># 修改配置文件</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">[</span>root@ubuntu2204 ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/cerebro/application.conf</span></pre></td></tr><tr><td data-num="23"></td><td><pre>data.path: <span class="token string">"/var/lib/cerebro/cerebro.db"</span>  <span class="token comment"># 取消此行注释</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token comment"># data.path = "./cerebro.db"              # 注释此行，默认路径是 /usr/share/cerebro/cerebro.db</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment"># 此目录自动生成</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">[</span>root@ubuntu2204 ~<span class="token punctuation">]</span><span class="token comment"># ll -d /var/lib/cerebro</span></pre></td></tr><tr><td data-num="28"></td><td><pre>drwxr-xr-x <span class="token number">2</span> cerebro cerebro <span class="token number">4096</span>   <span class="token number">4</span>月 <span class="token number">10</span>     <span class="token number">2021</span> /var/lib/cerebro/</pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token comment"># 重启服务</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">[</span>root@ubuntu2204 ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart cerebro.service</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">[</span>root@ubuntu2204 ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable --now cerebro.service</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token comment"># 默认监听 9000 端口</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">[</span>root@ubuntu2204 ~<span class="token punctuation">]</span><span class="token comment"># ss -ntlp | grep 9000</span></pre></td></tr><tr><td data-num="36"></td><td><pre>LISTEN   <span class="token number">0</span>   <span class="token number">100</span>   *:9000           *:*         users:<span class="token variable"><span class="token punctuation">((</span>"java"<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">26333</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">155</span><span class="token punctuation">))</span></span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token comment"># 访问下面链接地址</span></pre></td></tr><tr><td data-num="39"></td><td><pre>http://192.168.80.150:9000</pre></td></tr></table></figure><h4 id="访问-cerebro-页面"><a class="anchor" href="#访问-cerebro-页面">#</a> 访问 Cerebro 页面</h4><p>在 <code>Node address</code> 输入框中输入任意 ES 集群节点的地址： <code>http://192.168.80.151:9200</code></p><h2 id="4-es-集群节点类型"><a class="anchor" href="#4-es-集群节点类型">#</a> 4、ES 集群节点类型</h2><p>ES 集群中节点类型介绍：</p><ul><li>Master</li><li>Data</li><li>Ingest</li><li>Coordinating</li></ul><h3 id="41-cluster-state"><a class="anchor" href="#41-cluster-state">#</a> 4.1 Cluster State</h3><p><code>Cluster State</code> 是用来存储 Elasticsearch 集群相关的元数据信息。它存储在每个节点上，主要包含以下信息：</p><ul><li>节点信息：这部分信息包括节点名称或节点的 IP、节点的 IP 地址或端口等。</li><li>索引元数据：这部分信息包括索引的名称、索引的配置设置（如分片数量、副本数量等）以及字段类型和属性等。</li></ul><h3 id="42-master-角色"><a class="anchor" href="#42-master-角色">#</a> 4.2 Master 角色</h3><ol><li>Elasticsearch 集群中只能有一个处于激活状态的 Master 节点。Master 节点负责管理和控制整个集群的操作；</li><li>Master 节点负责维护集群状态（Cluster State）。当集群状态发生变化（例如，新增或删除索引、修改索引设置等）时，Master 节点会将更新后的集群状态同步给其他节点，以保持整个集群的状态一致性。</li><li>Master 节点是通过选举产生的。集群中的节点可以设置 <code>node.master: true</code> 来允许它成为 Master 节点的候选者（默认为 true）。如果当前的 Master 节点失效或不可用时，集群会自动触发选举过程，从候选者中选出一个新的 Master 节点。</li></ol><table><thead><tr><th>版本</th><th>角色配置</th></tr></thead><tbody><tr><td>7.X 版本</td><td>Master 角色:<br><code>node.master: true</code><br><code>node.data: false</code><br>Data 角色:<br><code>node.master: false</code><br><code>node.data: true</code><br>Coordinating 角色:<br><code>node.master: false</code><br><code>node.data: false</code></td></tr><tr><td>8.X 版本</td><td>Master 角色:<br><code>node.roles: [&quot;master&quot;,&quot;data&quot;]</code> (既当 master, 又当 data)<br>Data 角色:<br><code>node.roles: [&quot;data&quot;]</code><br>Coordinating 角色:<br><code>node.roles: []</code></td></tr></tbody></table><h3 id="43-data-角色"><a class="anchor" href="#43-data-角色">#</a> 4.3 Data 角色</h3><p>Data 节点是 Elasticsearch 集群中负责存储数据的节点。默认情况下，集群中的所有节点都是 Data 类型。</p><ol><li>可以通过设置 <code>node.data: true</code> （默认为 true）来保持节点作为 Data 节点。</li><li>当创建索引后，索引中的数据会被存储在一个或多个 Data 节点上。这些能够存储索引数据的节点被称为 Data 节点。Data 节点负责处理数据查询、聚合和搜索等操作，它们直接影响整个集群的性能和存储能力。</li></ol><p>通过合理分配和管理 Data 节点，可以提高 Elasticsearch 集群的数据处理能力、查询性能和存储容量。在实际应用中，需要根据业务需求和硬件资源来调整 Data 节点的数量和配置。</p><h3 id="44-ingest-角色"><a class="anchor" href="#44-ingest-角色">#</a> 4.4 Ingest 角色</h3><p>Ingest 节点是 Elasticsearch 集群中负责预处理文档的过程，它允许文档在被写入到 Elasticsearch 之前，对其进行处理、清洗、或转换。</p><ol><li>假设你有一个包含日志数据的 JSON 文档，其中包含一个时间戳字段，但格式不符合标准。我们就可以在文档被写入之前，使用 date 处理器来转换时间戳字段的格式。</li><li><code>node.ingest: true</code> 表示该节点可以对文档进行预处理操作。如果你希望某个节点不处理 Ingest 任务，可以设置为 false。</li></ol><h3 id="45-coordinating-角色"><a class="anchor" href="#45-coordinating-角色">#</a> 4.5 Coordinating 角色</h3><p>处理请求的节点被称为 Coordinating 节点。Coordinating 节点是 Elasticsearch 集群中所有节点的默认角色，无法取消。</p><ol><li>Coordinating 节点主要负责将请求路由到正确的节点。例如，创建索引的请求会被 Coordinating 节点路由到 Master 节点进行处理，而数据查询或写入的请求会被路由到相应的 Data 节点上。</li><li>当一个节点同时设置 <code>node.master：false</code> 、 <code>node.data：false</code> 时，该节点仅充当 Coordinating 路由节点的角色。</li></ol><h3 id="46-角色设定示例"><a class="anchor" href="#46-角色设定示例">#</a> 4.6 角色设定示例</h3><ol><li>如果希望节点只作为主节点<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># ES7.X</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">node.master</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">node.data</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># ES8.X</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token key atrule">node.roles</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"master"</span><span class="token punctuation">,</span> <span class="token string">"ingest"</span><span class="token punctuation">]</span>    <span class="token comment"># 只做 master, 不当 data</span></pre></td></tr></table></figure></li><li>如果希望节点只作为数据节点<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># ES7.X</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">node.master</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">node.data</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># ES8.X</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token key atrule">node.roles</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token string">"ingest"</span><span class="token punctuation">]</span>    <span class="token comment"># 只当 data, 不做 master</span></pre></td></tr></table></figure></li><li>如果希望节点同时担任数据节点和主节点<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># ES7.X</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">node.master</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">node.data</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># ES8.X</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token key atrule">node.roles</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"master"</span><span class="token punctuation">,</span> <span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token string">"ingest"</span><span class="token punctuation">]</span>    <span class="token comment"># 同时担任 master data</span></pre></td></tr></table></figure></li><li>如果希望节点不担任任何特定角色（不推荐）<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># ES7.X</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">node.master</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">node.data</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># ES8.X</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token key atrule">node.roles</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token comment"># 不担任任何角色</span></pre></td></tr></table></figure></li></ol><h3 id="5案例演示"><a class="anchor" href="#5案例演示">#</a> 5. 案例演示</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 修改 ES 配置</span></pre></td></tr><tr><td data-num="2"></td><td><pre>root@es-node1: <span class="token function">vim</span> /etc/elasticsearch/elasticsearch.yml</pre></td></tr><tr><td data-num="3"></td><td><pre>node.roles: <span class="token punctuation">[</span><span class="token string">"data"</span>, <span class="token string">"ingest"</span><span class="token punctuation">]</span>    <span class="token comment"># 不做 master 节点 (默认每个节点都存在: master data ingest)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 重启 ES 服务</span></pre></td></tr><tr><td data-num="6"></td><td><pre>root@es-node1: systemctl restart elasticsearch</pre></td></tr></table></figure><h2 id="5-es-集群分片"><a class="anchor" href="#5-es-集群分片">#</a> 5、ES 集群分片</h2><h3 id="51-什么是分片"><a class="anchor" href="#51-什么是分片">#</a> 5.1 什么是分片</h3><p>分片是处理和存储 PB 级别数据的基础。在 Elasticsearch 中，分片是一种<strong>数据分区机制</strong>，它允许将一份完整的数据分散存储到集群的多个不同服务器上。而每个分片只是索引的一个部分，这使得它们可以独立进行存储和查询。</p><p>在 Elasticsearch 中，分片又被分为了两种类型：</p><ol><li><strong>主分片</strong>：主要负责存储数据。创建后主分片的数量是固定的（不允许修改）。</li><li><strong>副本分片</strong>：每个主分片可以配置一个或多个副本分片，以增强数据的容错能力。副本分片从对应的主分片同步数据，确保在主分片出现问题时仍能提供服务。</li></ol><h3 id="52-什么是副本分片"><a class="anchor" href="#52-什么是副本分片">#</a> 5.2 什么是副本分片</h3><p>副本分片主要用于提高数据的可用性，这样即使某个节点发生故障，系统依然可以自动从其他节点上的副本分片中恢复，并继续提供数据访问服务。</p><p>如下图所示，node2 上是 oldwang_index 索引的一个完整副本数据。</p><h3 id="53-es-集群如何增大容量"><a class="anchor" href="#53-es-集群如何增大容量">#</a> 5.3 ES 集群如何增大容量</h3><ol><li>如下 3 个节点的 ES 集群，创建了一个 oldwang_index 索引，同时指定了 3 个分片，和 1 个副本<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 创建索引，设定主分片和副本分片</span></pre></td></tr><tr><td data-num="2"></td><td><pre>PUT /oldwang_index</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token string">"settings"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token string">"index"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token string">"number_of_shards"</span><span class="token builtin class-name">:</span> <span class="token number">3</span>,    <span class="token comment"># 主分片</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token string">"number_of_replicas"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>   <span class="token comment"># 副本分配</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># 动态修改副本分片</span></pre></td></tr><tr><td data-num="13"></td><td><pre>PUT /oldwang_index/_settings</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token string">"number_of_replicas"</span><span class="token builtin class-name">:</span> <span class="token number">2</span>    <span class="token comment"># 三节点，三分片。因此最多只需要两副本就完全够了.</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li></ol><p><strong>问题</strong>：目前一共有 3 个 ES 节点，如果此时增加一个新节点 是否能提高 oldwang_index 索引数据容量？<br><strong>答案</strong>：不能，因为 oldwang_index 只有 3 个分片，已经分布在 3 台节点上，那么新增的第四个节点对于 oldwang_index 而言是无法使用到的。所以也无法带来数据容量的提升。</p><h3 id="54-es-集群如何增加读性能"><a class="anchor" href="#54-es-集群如何增加读性能">#</a> 5.4 ES 集群如何增加读性能</h3><p><strong>问题</strong>：目前一共有 3 个 ES 节点，如果增加副本数是否能提高 oldwang_index 索引的读性能？<br><strong>答案</strong>：不能，因为新增的副本还是会分布在这 node1、node2、node3 这三个节点上的，还是使用了相同的资源，也就意味着有读请求来时，这些请求还是会分配到 node1、node2、node3 上进行处理、也就意味着，还是利用了相同的硬件资源，所以不会提升读性能。</p><p><strong>问题</strong>：如果需要增加读吞吐量性能，应该怎么来做？<br><strong>答案</strong>：增加读吞吐量还是需要添加节点，比如在增加三个节点 node4、node5、node6 那么将原来的 R0、R1、R2 分别迁移至新增的三个节点上，当有读请求来时会被分配 node4、node5、node6，也就意味着有新的 CPU、内存、IO，这样就不会在占用 node1、node2、node3 的硬件资源，那么这个时候读吞吐量才会得到真正的提升。</p><h3 id="55-es-副本与分片总结"><a class="anchor" href="#55-es-副本与分片总结">#</a> 5.5 ES 副本与分片总结</h3><p>分片数和副本的设定非常重要，需要在集群部署前进行仔细规划：</p><ol><li><strong>分片过小</strong>：可能导致在后续需要水平扩容时无法通过增加节点来实现，因为数据已经在现有节点上达到了分布的极限。</li><li><strong>分片过大</strong>：可能会导致单个节点上分布过多的分片，从而造成资源的浪费。此外，过多的分片也会影响 ES 的查询性能。</li></ol><h2 id="6-es-集群故障转移"><a class="anchor" href="#6-es-集群故障转移">#</a> 6、ES 集群故障转移</h2><h3 id="61-什么是故障转移"><a class="anchor" href="#61-什么是故障转移">#</a> 6.1 什么是故障转移</h3><p>所谓故障转移指的是，当集群中有节点发生故障时，这个集群是如何进行自动修复的。<br>ES 集群目前是由 3 个节点组成，此时集群状态是 green。</p><h3 id="62-模拟节点故障案例"><a class="anchor" href="#62-模拟节点故障案例">#</a> 6.2 模拟节点故障案例</h3><p>假设：node1 所在机器宕机导致服务终止，此时 ES 集群会如何处理；大体分为三个步骤：</p><ol><li><p><strong>重新选举</strong></p></li><li><p><strong>主分片调整</strong></p></li><li><p><strong>副本分片调整</strong></p></li><li><p><strong>重新选举阶段</strong>：node2 和 node3 发现 node1 无法响应；一段时间后会发起 master 选举。此时集群状态变为 Red 状态，假定选择 node2 为 master 节点；</p></li><li><p><strong>主分片调整阶段</strong>：node2 发现主分片 P0 未分配，将 node3 上的 R0 提升为主分片。此时所有的主分片都正常分配，集群状态变为 Yellow 状态；</p></li><li><p><strong>副本分片调整阶段</strong>：node2 将 P0 和 P1 主分片 重新生成新的副本分片 R0、R1。此时集群状态变为 Green；</p></li></ol><h2 id="7-es-文档路由原理"><a class="anchor" href="#7-es-文档路由原理">#</a> 7、ES 文档路由原理</h2><p>ES 文档分布式存储，当一个文档存储至 ES 集群时，存储的原理是什么样的？<br>如图所示，当我们想在一个集群保存文档时，Document1 是如何存储到分片 P1 的？选择 P1 的依据是什么？</p><p>其实是有一个 <strong>文档到分片的映射算法</strong>，其目的是使所有文档均匀分布在所有的分片上。ES 既不使用随机算法，也不使用轮询算法，而是通过以下公式计算文档对应的分片：</p><pre><code>shard = hash(routing) % number_of_primary_shards
</code></pre><ul><li><code>hash</code> ：算法保证将数据均匀分散在分片中</li><li><code>routing</code> ：是一个关键参数，默认是文档 id, 也可以自定义。</li><li><code>number_of_primary_shards</code> ：主分片数（与主分片取模）</li></ul><p><strong>注意</strong>：该算法与主分片数相关，一旦确定后便不能更改主分片。因为一旦修改主分片数量， <code>shard</code> 的计算结果就会完全不一样，会导致无法定位到原有数据。</p><p><strong>总结</strong>：ES 用 <code>hash(routing) % 主分片数</code> 来把文档分配到对应分片，确保分布均衡且可定位，因此主分片数不能改，否则找不到数据。</p><h3 id="71-文档的创建流程"><a class="anchor" href="#71-文档的创建流程">#</a> 7.1 文档的创建流程</h3><ol><li>客户端发送请求：请求发送到任意节点（协调节点）。</li><li>路由计算：协调节点 根据文档 ID 计算分片号： <code>shard = hash(document_id) % 主分片数量</code></li><li>定位主分片：找到对应的主分片所在节点。</li><li>主分片写入：写入内存 + translog，同时转发给副本分片。</li><li>副本写入：副本分片完成相同写入操作。</li><li>写入成功：所有副本确认后，最终返回成功响应给客户端。</li></ol><h3 id="72-文档的读取流程"><a class="anchor" href="#72-文档的读取流程">#</a> 7.2 文档的读取流程</h3><ol><li>客户端发起查询请求：发送到任意节点（协调节点）。</li><li>协调节点分发请求到所有分片：查询是并行的，包括主分片和副本分片中任选一个。</li><li>每个分片独立查询：每个分片返回自己的匹配结果（文档 + 分数等）。</li><li>协调节点合并结果：统一排序、分页等，生成最终结果。</li><li>返回客户端：查询结果发送回客户端。</li></ol><h3 id="73-文档批量创建的流程"><a class="anchor" href="#73-文档批量创建的流程">#</a> 7.3 文档批量创建的流程</h3><p>（原文未补充内容）</p><h3 id="74-文档批量读取的流程"><a class="anchor" href="#74-文档批量读取的流程">#</a> 7.4 文档批量读取的流程</h3><p>（原文未补充内容）</p><h2 id="8-es-集群节点扩展"><a class="anchor" href="#8-es-集群节点扩展">#</a> 8、ES 集群节点扩展</h2><h3 id="81-环境准备"><a class="anchor" href="#81-环境准备">#</a> 8.1 环境准备</h3><table><thead><tr><th>系统版本</th><th>主机名称</th><th>IP 地址</th></tr></thead><tbody><tr><td>RockyLinux9</td><td>es-node4</td><td>192.168.80.154</td></tr><tr><td>RockyLinux9</td><td>es-node5</td><td>192.168.80.155</td></tr></tbody></table><h3 id="82-es-扩展-data-节点"><a class="anchor" href="#82-es-扩展-data-节点">#</a> 8.2 ES 扩展 Data 节点</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@node4 ~<span class="token punctuation">]</span><span class="token comment"># grep "^[a-Z]" /etc/elasticsearch/elasticsearch.yml</span></pre></td></tr><tr><td data-num="2"></td><td><pre>cluster.name: es-cluster            <span class="token comment"># 集群名称</span></pre></td></tr><tr><td data-num="3"></td><td><pre>node.name: es-node4                 <span class="token comment"># 节点名称</span></pre></td></tr><tr><td data-num="4"></td><td><pre>node.roles: <span class="token punctuation">[</span><span class="token string">"data"</span>, <span class="token string">"ingest"</span><span class="token punctuation">]</span>      <span class="token comment"># ES8.x 配置 Data 节点，不参与 Master 选举</span></pre></td></tr><tr><td data-num="5"></td><td><pre>http.port: <span class="token number">9200</span></pre></td></tr><tr><td data-num="6"></td><td><pre>path.data: /var/lib/elasticsearch</pre></td></tr><tr><td data-num="7"></td><td><pre>path.logs: /var/log/elasticsearch</pre></td></tr><tr><td data-num="8"></td><td><pre>network.host: <span class="token number">192.168</span>.80.154        <span class="token comment"># 内网 IP 地址</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># bootstrap.memory_lock: true</span></pre></td></tr><tr><td data-num="10"></td><td><pre>discovery.seed_hosts: <span class="token punctuation">[</span><span class="token string">"192.168.80.151"</span>, <span class="token string">"192.168.80.152"</span>, <span class="token string">"192.168.80.153"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># Enable security features</span></pre></td></tr><tr><td data-num="13"></td><td><pre>xpack.security.enabled: <span class="token boolean">false</span></pre></td></tr><tr><td data-num="14"></td><td><pre>xpack.security.enrollment.enabled: <span class="token boolean">false</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># ES7.X 配置方式</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># node.data: true          # Data 节点</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment"># node.master: false       # 不参与 Master 选举</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">[</span>root@node4 ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart elasticsearch</span></pre></td></tr></table></figure><p>访问 CereBro 验证节点，路径： <code>Nodes &gt; Data 角色</code></p><h3 id="83-es-扩展-coordinating-节点"><a class="anchor" href="#83-es-扩展-coordinating-节点">#</a> 8.3 ES 扩展 Coordinating 节点</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@node5 ~<span class="token punctuation">]</span><span class="token comment"># grep "^[a-Z]" /etc/elasticsearch/elasticsearch.yml</span></pre></td></tr><tr><td data-num="2"></td><td><pre>cluster.name: es-cluster                <span class="token comment"># 集群名称</span></pre></td></tr><tr><td data-num="3"></td><td><pre>node.name: es-node5                     <span class="token comment"># 节点名称</span></pre></td></tr><tr><td data-num="4"></td><td><pre>node.roles: <span class="token punctuation">[</span><span class="token punctuation">]</span>                          <span class="token comment"># ES8 配置 Coordinating 节点</span></pre></td></tr><tr><td data-num="5"></td><td><pre>http.port: <span class="token number">9200</span></pre></td></tr><tr><td data-num="6"></td><td><pre>path.data: /var/lib/elasticsearch</pre></td></tr><tr><td data-num="7"></td><td><pre>path.logs: /var/log/elasticsearch</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># bootstrap.memory_lock: true</span></pre></td></tr><tr><td data-num="9"></td><td><pre>network.host: <span class="token number">192.168</span>.80.155             <span class="token comment"># 内网 IP 地址</span></pre></td></tr><tr><td data-num="10"></td><td><pre>discovery.seed_hosts: <span class="token punctuation">[</span><span class="token string">"192.168.80.151"</span>, <span class="token string">"192.168.80.152"</span>, <span class="token string">"192.168.80.153"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># Enable security features</span></pre></td></tr><tr><td data-num="12"></td><td><pre>xpack.security.enabled: <span class="token boolean">false</span></pre></td></tr><tr><td data-num="13"></td><td><pre>xpack.security.enrollment.enabled: <span class="token boolean">false</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># ES7.X 配置方式</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># node.data: false     # 不参与 Data 节点</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># node.master: false   # 不参与 Master 选举</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">[</span>root@node5 ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart elasticsearch</span></pre></td></tr></table></figure><h3 id="84-节点扩展检查"><a class="anchor" href="#84-节点扩展检查">#</a> 8.4 节点扩展检查</h3><p>通过 cerebro 检查集群扩展后的状态。<br>如果出现集群无法加入、或者加入集群被拒绝，尝试删除 <code>/var/lib/elasticsearch</code> 下的文件，然后重启 ES：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@node5 ~<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/lib/elasticsearch/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@node5 ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart elasticsearch</span></pre></td></tr></table></figure><p>如果将 data 节点修改为 Coordinating 节点，需要清理数据，否则无法启动：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># repurpose 重新调整</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@node5 ~<span class="token punctuation">]</span><span class="token comment"># /usr/share/elasticsearch/bin/elasticsearch-node repurpose</span></pre></td></tr><tr><td data-num="3"></td><td><pre>------------------------------------------------------------------------</pre></td></tr><tr><td data-num="4"></td><td><pre>WARNING: Elasticsearch MUST be stopped before running this tool.</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>Found <span class="token number">1</span> indices <span class="token punctuation">(</span><span class="token number">1</span> shards and <span class="token number">1</span> index meta data<span class="token punctuation">)</span> to clean up</pre></td></tr><tr><td data-num="7"></td><td><pre>Use <span class="token parameter variable">-v</span> to see list of paths and indices affected</pre></td></tr><tr><td data-num="8"></td><td><pre>Node is being re-purposed as no-master and no-data. Clean-up of index data will be performed.</pre></td></tr><tr><td data-num="9"></td><td><pre>Do you want to proceed?</pre></td></tr><tr><td data-num="10"></td><td><pre>Confirm <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span> y</pre></td></tr><tr><td data-num="11"></td><td><pre>Node successfully repurposed to no-master and no-data.</pre></td></tr></table></figure><p>访问 CereBro 验证节点，路径： <code>Nodes &gt; Coordinating 角色</code></p><h2 id="9-es-集群调优建议"><a class="anchor" href="#9-es-集群调优建议">#</a> 9、ES 集群调优建议</h2><h3 id="91-内核参数优化"><a class="anchor" href="#91-内核参数优化">#</a> 9.1 内核参数优化</h3><ol><li><strong>内核参数优化</strong><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/sysctl.conf</span></pre></td></tr><tr><td data-num="2"></td><td><pre>fs.file-max<span class="token operator">=</span><span class="token number">655360</span>                        <span class="token comment"># 设定系统最大打开文件描述符数，建议修改为 655360 或者更高；</span></pre></td></tr><tr><td data-num="3"></td><td><pre>vm.max_map_count <span class="token operator">=</span> <span class="token number">262144</span>                 <span class="token comment"># 用于限制一个进程可以拥有的虚拟内存大小，建议修改成 262144 或更高。</span></pre></td></tr><tr><td data-num="4"></td><td><pre>net.core.somaxconn <span class="token operator">=</span> <span class="token number">32768</span>                <span class="token comment"># 设置系统允许的最大套接字监听（TCP SYN）队列长度；</span></pre></td></tr><tr><td data-num="5"></td><td><pre>net.ipv4.tcp_tw_reuse <span class="token operator">=</span> <span class="token number">1</span>                 <span class="token comment"># 启用 TCP TIME-WAIT 状态的套接字重用。</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># net.ipv4.ip_local_port_range = 1000 65535 # 设置本地端口范围，即操作系统分配给本地套接字的端口号范围。</span></pre></td></tr><tr><td data-num="7"></td><td><pre>net.ipv4.tcp_max_tw_buckets <span class="token operator">=</span> <span class="token number">400000</span>      <span class="token comment"># 表示操作系统允许 TIME_WAIT 数量的最大值，如果超过这个数字，TIME_WAIT 套接字将立刻被清除</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># sysctl -p</span></pre></td></tr></table></figure></li><li><strong>调整用户最大进程数（nproc），调整进程最大打开的文件描述符（nofile）</strong><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># rm -f /etc/security/limits.d/20-nproc.conf     # 删除默认 nproc 设定文件</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/security/limits.conf</span></pre></td></tr><tr><td data-num="3"></td><td><pre>*                soft    core           unlimited</pre></td></tr><tr><td data-num="4"></td><td><pre>*                hard    core           unlimited</pre></td></tr><tr><td data-num="5"></td><td><pre>*                soft    nproc          <span class="token number">1000000</span></pre></td></tr><tr><td data-num="6"></td><td><pre>*                hard    nproc          <span class="token number">1000000</span></pre></td></tr><tr><td data-num="7"></td><td><pre>*                soft    nofile         <span class="token number">1000000</span></pre></td></tr><tr><td data-num="8"></td><td><pre>*                hard    nofile         <span class="token number">1000000</span></pre></td></tr><tr><td data-num="9"></td><td><pre>*                soft    memlock        <span class="token number">32000</span></pre></td></tr><tr><td data-num="10"></td><td><pre>*                hard    memlock        <span class="token number">32000</span></pre></td></tr><tr><td data-num="11"></td><td><pre>*                soft    msgqueue       <span class="token number">8192000</span></pre></td></tr><tr><td data-num="12"></td><td><pre>*                hard    msgqueue       <span class="token number">8192000</span></pre></td></tr></table></figure></li></ol><h3 id="92-配置参数优化"><a class="anchor" href="#92-配置参数优化">#</a> 9.2 配置参数优化</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 1. 启用内存锁定，避免 ES 使用 swap 交换分区，频繁的交换，会导致 IOPS 变高.</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@es-node ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/elasticsearch/elasticsearch.yml</span></pre></td></tr><tr><td data-num="3"></td><td><pre>bootstrap.memory_lock: <span class="token boolean">true</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 2. 当 ES 配置内存锁定后，需要确保操作系统允许 Elasticsearch 进程锁定足够的内存.</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>root@es-node ~<span class="token punctuation">]</span><span class="token comment"># sed -i '/\[Service\]/a LimitMEMLOCK=infinity' /usr/lib/systemd/system/elasticsearch.service</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 3. 重新启动 elasticSearch</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">[</span>root@es-node ~<span class="token punctuation">]</span><span class="token comment"># systemctl daemon-reload</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">[</span>root@es-node ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart elasticsearch</span></pre></td></tr></table></figure><h3 id="93-jvm-参数优化"><a class="anchor" href="#93-jvm-参数优化">#</a> 9.3 JVM 参数优化</h3><h4 id="931-基础原则"><a class="anchor" href="#931-基础原则">#</a> 9.3.1 基础原则</h4><p>要估算 JVM 内存配置，主要看两点：</p><ul><li>要存多少数据</li><li>有多少个节点（服务器）</li></ul><p>经验公式：<strong>1GB 内存 可以支持 48GB ~ 96GB 的数据量</strong>（通常按 1:48 来算最保险）<br>单个主分片大小最好控制在 <strong>30GB~50GB</strong></p><h4 id="932-怎么估算内存和分片"><a class="anchor" href="#932-怎么估算内存和分片">#</a> 9.3.2 怎么估算内存和分片？</h4><p><strong>第一步</strong>：算出实际需要存储的数据量</p><pre><code>实际存储量 = 总数据量 × (副本数 + 1)    // 因为副本也要占空间
</code></pre><p>例如：总数据量 1TB + 副本数据 → 实际存储数据量 2TB</p><p><strong>第二步</strong>：算每个节点要存多少数据</p><pre><code>每节点存储 = 实际数据量 ÷ 节点数    // 再加上 20% 预留空间
</code></pre><p>示例：实际存储量 2TB / 3 节点 + 20% 预留空间 → 每节点存储 850G</p><p><strong>第三步</strong>：算每个节点需要多少内存</p><pre><code>节点内存 ≈ 每节点存储量 ÷ 48（按1:48比例来算）
</code></pre><p>示例：每节点存储量 850G ÷ 48 → 节点内存 17 G</p><p><strong>第四步</strong>：算分片数量（用于 ES）</p><pre><code>主分片数量 = 总数据量 ÷ 30GB（建议一个分片控制在 30GB 左右）
总分片数 = 主分片数 × (副本数 + 1)
</code></pre><p>示例：主分片数量 ≈ 33 → 总分片数 ≈ 66</p><h4 id="933-两个简单例子"><a class="anchor" href="#933-两个简单例子">#</a> 9.3.3 两个简单例子</h4><p><strong>示例 1</strong>：1TB 数据，3 个节点，1 个副本</p><ol><li>实际要存：1TB × (1 + 1) = 2 TB</li><li>每节点：2TB ÷ 3 ≈ 700GB → 加 20% ≈ 850GB // 单节点实际存储</li><li>内存需求：850GB ÷ 48 ≈ 17GB // 单节点建议内存 17 * 2 ≈ 34G</li><li>JVM 配置：每个节点内存 17GB</li><li>分片数量：1TB ÷ 30GB ≈ 33 个主分片</li><li>总分片数 = 33 × 2 = 66 个</li><li>单个索引分片数<br>a. 每日数据量 ÷ 30G = （总数据量 ÷ 保留天数）÷ 30G<br>b. 100 ÷ 30G = 3 分片 // 每天 100G 日志<br>c. 1024 ÷ 30G = 33 分片 // 每天 1024G 日志</li></ol><p><strong>示例 2</strong>：2TB 数据，3 个节点，1 个副本</p><ol><li>实际要存：2TB × 2 = 4TB</li><li>每节点：4TB ÷ 3 ≈ 1.4TB → 加 20% ≈ 1.7TB // 单节点存储</li><li>内存需求：1.7TB ÷ 48 ≈ 35GB → 超过建议上限（31GB）→ ⚠️ 不够用，得加节点！</li></ol><p>增加到 4 个节点</p><ol><li>每节点：4TB ÷ 4 = 1TB → 加 20% ≈ 1.2TB</li><li>内存需求：1.2TB ÷ 48 ≈ 25GB → 合理！</li><li>分片数量：2TB ÷ 30GB = 60 个主分片 → 总分片数 = 60 × 2 = 120 个</li></ol><p><strong>结论</strong>：用 4 个节点，内存控制在 31GB 以内，刚刚好！</p><h4 id="934-生产环境建议"><a class="anchor" href="#934-生产环境建议">#</a> 9.3.4 生产环境建议</h4><ul><li>每天数据量：约 1TB</li><li>机器配置：16 核，64GB 内存，6TB 磁盘（3 台 ECS）</li><li>JVM 设置：最大和最小内存都设为 31GB</li><li>最好不要超过 32GB（超过后 JVM 的内存优化会失效）</li><li>ES 清理策略：只保留最近 1~2 周的数据，避免磁盘被撑爆。</li></ul><p>✅ <strong>结论</strong></p><ul><li>每天数据约 1TB，建议单分片控制在 30~50GB，1TB / 30GB ≈ 每天 33 个主分片。</li><li>实际存储量 = 日志量 × (副本数 + 1)，估算内存按 1:48 比例。</li><li>JVM 不建议超过 31GB，超过后 G1 GC 优化失效。</li><li>索引清理建议使用 ILM，仅保留最近 1~2 周数据，避免磁盘撑满。</li></ul><hr><div class="tags"><a href="/tags/ELK/" rel="tag"><i class="ic i-tag"></i>ELK</a></div></div><footer><div class="meta"><span class="icon"><i class="ic i-eye"></i></span><span>此文章已被阅读次数:</span><span class="waline-pageview-count" id="twikoo_visitors" data-path="/posts/3192084428.html">正在加载...</span><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新于</span><time title="修改时间：2025-12-10 10:06:08" itemprop="dateModified" datetime="2025-12-10T10:06:08+08:00">2025-12-10</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i>赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img loading="lazy" data-src="/assets/wechatpay.png" alt="Jaxx.Wang 微信支付"><p>微信支付</p></div><div><img loading="lazy" data-src="/assets/alipay.png" alt="Jaxx.Wang 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者：</strong>Jaxx.Wang<i class="ic i-at"><em>@</em></i>老王的个人博客</li><li class="link"><strong>本文链接：</strong><a href="http://blog.oldwang.site/posts/3192084428.html" title="03 Elasticsearch 集群">http://blog.oldwang.site/posts/3192084428.html</a></li><li class="license"><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/posts/4103087246.html" rel="prev" itemprop="url" data-background-image="https:&#x2F;&#x2F;pic1.imgdb.cn&#x2F;item&#x2F;6937b67800233646958ccbaf.jpg" title="02 Elasticsearch 入门"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>ELK</span><h3>02 Elasticsearch 入门</h3></a></div><div class="item right"><a href="/posts/3825997150.html" rel="next" itemprop="url" data-background-image="https:&#x2F;&#x2F;pic1.imgdb.cn&#x2F;item&#x2F;6937b67900233646958ccbb2.jpg" title="01 ELK 日志收集系统概述"><span class="type">下一篇</span><span class="category"><i class="ic i-flag"></i>ELK</span><h3>01 ELK 日志收集系统概述</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-elasticsearch-%E9%9B%86%E7%BE%A4"><span class="toc-number">1.</span> <span class="toc-text">1、ElasticSearch 集群</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-es-%E9%9B%86%E7%BE%A4%E4%BC%98%E5%8A%BF"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 ES 集群优势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-es-%E5%A6%82%E4%BD%95%E7%BB%84%E9%9B%86%E7%BE%A4"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 ES 如何组集群</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-es-%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2"><span class="toc-number">2.</span> <span class="toc-text">2、ES 集群环境部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#20-%E7%8E%AF%E5%A2%83%E5%9C%B0%E5%9D%80%E8%A7%84%E5%88%92"><span class="toc-number">2.1.</span> <span class="toc-text">2.0 环境地址规划</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#21-node1-%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.</span> <span class="toc-text">2.1 node1 集群节点配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-node2-%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AE"><span class="toc-number">2.3.</span> <span class="toc-text">2.2 node2 集群节点配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-node3-%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AE"><span class="toc-number">2.4.</span> <span class="toc-text">2.3 node3 集群节点配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-es-%E9%9B%86%E7%BE%A4%E7%8A%B6%E6%80%81%E6%A3%80%E6%B5%8B"><span class="toc-number">3.</span> <span class="toc-text">3、ES 集群状态检测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#31-es-%E9%9B%86%E7%BE%A4%E6%8C%87%E6%A0%87%E7%8A%B6%E6%80%81"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 ES 集群指标状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-curl-%E5%91%BD%E4%BB%A4%E6%A3%80%E6%9F%A5%E9%9B%86%E7%BE%A4%E7%8A%B6%E6%80%81"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 Curl 命令检查集群状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#33-%E5%AE%89%E8%A3%85-cerebro-%E6%A3%80%E6%9F%A5%E9%9B%86%E7%BE%A4%E7%8A%B6%E6%80%81"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 安装 Cerebro 检查集群状态</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rockylinux9-%E9%83%A8%E7%BD%B2-cerebro"><span class="toc-number">3.3.1.</span> <span class="toc-text">RockyLinux9 部署 Cerebro</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ubuntu2204-%E9%83%A8%E7%BD%B2-cerebro"><span class="toc-number">3.3.2.</span> <span class="toc-text">Ubuntu2204 部署 Cerebro</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE-cerebro-%E9%A1%B5%E9%9D%A2"><span class="toc-number">3.3.3.</span> <span class="toc-text">访问 Cerebro 页面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-es-%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.</span> <span class="toc-text">4、ES 集群节点类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#41-cluster-state"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 Cluster State</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-master-%E8%A7%92%E8%89%B2"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 Master 角色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#43-data-%E8%A7%92%E8%89%B2"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 Data 角色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#44-ingest-%E8%A7%92%E8%89%B2"><span class="toc-number">4.4.</span> <span class="toc-text">4.4 Ingest 角色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#45-coordinating-%E8%A7%92%E8%89%B2"><span class="toc-number">4.5.</span> <span class="toc-text">4.5 Coordinating 角色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#46-%E8%A7%92%E8%89%B2%E8%AE%BE%E5%AE%9A%E7%A4%BA%E4%BE%8B"><span class="toc-number">4.6.</span> <span class="toc-text">4.6 角色设定示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E6%A1%88%E4%BE%8B%E6%BC%94%E7%A4%BA"><span class="toc-number">4.7.</span> <span class="toc-text">5. 案例演示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-es-%E9%9B%86%E7%BE%A4%E5%88%86%E7%89%87"><span class="toc-number">5.</span> <span class="toc-text">5、ES 集群分片</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#51-%E4%BB%80%E4%B9%88%E6%98%AF%E5%88%86%E7%89%87"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 什么是分片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#52-%E4%BB%80%E4%B9%88%E6%98%AF%E5%89%AF%E6%9C%AC%E5%88%86%E7%89%87"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 什么是副本分片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#53-es-%E9%9B%86%E7%BE%A4%E5%A6%82%E4%BD%95%E5%A2%9E%E5%A4%A7%E5%AE%B9%E9%87%8F"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 ES 集群如何增大容量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#54-es-%E9%9B%86%E7%BE%A4%E5%A6%82%E4%BD%95%E5%A2%9E%E5%8A%A0%E8%AF%BB%E6%80%A7%E8%83%BD"><span class="toc-number">5.4.</span> <span class="toc-text">5.4 ES 集群如何增加读性能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#55-es-%E5%89%AF%E6%9C%AC%E4%B8%8E%E5%88%86%E7%89%87%E6%80%BB%E7%BB%93"><span class="toc-number">5.5.</span> <span class="toc-text">5.5 ES 副本与分片总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-es-%E9%9B%86%E7%BE%A4%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB"><span class="toc-number">6.</span> <span class="toc-text">6、ES 集群故障转移</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#61-%E4%BB%80%E4%B9%88%E6%98%AF%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB"><span class="toc-number">6.1.</span> <span class="toc-text">6.1 什么是故障转移</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#62-%E6%A8%A1%E6%8B%9F%E8%8A%82%E7%82%B9%E6%95%85%E9%9A%9C%E6%A1%88%E4%BE%8B"><span class="toc-number">6.2.</span> <span class="toc-text">6.2 模拟节点故障案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-es-%E6%96%87%E6%A1%A3%E8%B7%AF%E7%94%B1%E5%8E%9F%E7%90%86"><span class="toc-number">7.</span> <span class="toc-text">7、ES 文档路由原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#71-%E6%96%87%E6%A1%A3%E7%9A%84%E5%88%9B%E5%BB%BA%E6%B5%81%E7%A8%8B"><span class="toc-number">7.1.</span> <span class="toc-text">7.1 文档的创建流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#72-%E6%96%87%E6%A1%A3%E7%9A%84%E8%AF%BB%E5%8F%96%E6%B5%81%E7%A8%8B"><span class="toc-number">7.2.</span> <span class="toc-text">7.2 文档的读取流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#73-%E6%96%87%E6%A1%A3%E6%89%B9%E9%87%8F%E5%88%9B%E5%BB%BA%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="toc-number">7.3.</span> <span class="toc-text">7.3 文档批量创建的流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#74-%E6%96%87%E6%A1%A3%E6%89%B9%E9%87%8F%E8%AF%BB%E5%8F%96%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="toc-number">7.4.</span> <span class="toc-text">7.4 文档批量读取的流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-es-%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9%E6%89%A9%E5%B1%95"><span class="toc-number">8.</span> <span class="toc-text">8、ES 集群节点扩展</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#81-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">8.1.</span> <span class="toc-text">8.1 环境准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#82-es-%E6%89%A9%E5%B1%95-data-%E8%8A%82%E7%82%B9"><span class="toc-number">8.2.</span> <span class="toc-text">8.2 ES 扩展 Data 节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#83-es-%E6%89%A9%E5%B1%95-coordinating-%E8%8A%82%E7%82%B9"><span class="toc-number">8.3.</span> <span class="toc-text">8.3 ES 扩展 Coordinating 节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#84-%E8%8A%82%E7%82%B9%E6%89%A9%E5%B1%95%E6%A3%80%E6%9F%A5"><span class="toc-number">8.4.</span> <span class="toc-text">8.4 节点扩展检查</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-es-%E9%9B%86%E7%BE%A4%E8%B0%83%E4%BC%98%E5%BB%BA%E8%AE%AE"><span class="toc-number">9.</span> <span class="toc-text">9、ES 集群调优建议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#91-%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0%E4%BC%98%E5%8C%96"><span class="toc-number">9.1.</span> <span class="toc-text">9.1 内核参数优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#92-%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E4%BC%98%E5%8C%96"><span class="toc-number">9.2.</span> <span class="toc-text">9.2 配置参数优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#93-jvm-%E5%8F%82%E6%95%B0%E4%BC%98%E5%8C%96"><span class="toc-number">9.3.</span> <span class="toc-text">9.3 JVM 参数优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#931-%E5%9F%BA%E7%A1%80%E5%8E%9F%E5%88%99"><span class="toc-number">9.3.1.</span> <span class="toc-text">9.3.1 基础原则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#932-%E6%80%8E%E4%B9%88%E4%BC%B0%E7%AE%97%E5%86%85%E5%AD%98%E5%92%8C%E5%88%86%E7%89%87"><span class="toc-number">9.3.2.</span> <span class="toc-text">9.3.2 怎么估算内存和分片？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#933-%E4%B8%A4%E4%B8%AA%E7%AE%80%E5%8D%95%E4%BE%8B%E5%AD%90"><span class="toc-number">9.3.3.</span> <span class="toc-text">9.3.3 两个简单例子</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#934-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E5%BB%BA%E8%AE%AE"><span class="toc-number">9.3.4.</span> <span class="toc-text">9.3.4 生产环境建议</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/posts/3825997150.html" rel="bookmark" title="01 ELK 日志收集系统概述">01 ELK 日志收集系统概述</a></li><li class="active"><a href="/posts/3192084428.html" rel="bookmark" title="03 Elasticsearch 集群">03 Elasticsearch 集群</a></li><li><a href="/posts/4103087246.html" rel="bookmark" title="02 Elasticsearch 入门">02 Elasticsearch 入门</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="Jaxx.Wang" src="/assets/avatar.jpg"><p class="name" itemprop="name">Jaxx.Wang</p><div class="description" itemprop="description">这是一个 LinuxSre 相关的技术播客</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">3</span><span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">1</span><span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">1</span><span class="name">标签</span></a></div></nav><div class="social"><a target="_blank" rel="noopener" href="https://github.com/REPUC" class="item github" title="https:&#x2F;&#x2F;github.com&#x2F;REPUC"><i class="ic i-github"></i></a><a target="_blank" rel="noopener" href="https://space.bilibili.com/1886736881" class="item bilibili" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;1886736881"><i class="ic i-youtube"></i></a><a href="mailto:1281570031@qq.com" class="item email" title="mailto:1281570031@qq.com"><i class="ic i-envelope"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-about"></i>关于</a></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/posts/3825997150.html" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/posts/4103087246.html" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/ELK/" title="分类于ELK">ELK</a></div><span><a href="/posts/3192084428.html">03 Elasticsearch 集群</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ELK/" title="分类于ELK">ELK</a></div><span><a href="/posts/3825997150.html">01 ELK 日志收集系统概述</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ELK/" title="分类于ELK">ELK</a></div><span><a href="/posts/4103087246.html">02 Elasticsearch 入门</a></span></li></ul></div><div class="rpost pjax"><h2>最新评论</h2><ul class="leancloud-recent-comment" id="new-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2022 -<span itemprop="copyrightYear">2025</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">Jaxx.Wang @ Jaxx.Wang</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站点总字数">30k 字</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站点阅读时长">27 分钟</span></div><div class="powered-by">基于 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> & Theme.<a target="_blank" rel="noopener" href="https://github.com/theme-shoka-x/hexo-theme-shokaX/">ShokaX</a></div><br><span style="display:inline;height:20px;line-height:20px;margin:0 0 0 5px;color:var(--grey-5)"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn">2022002072</a><br><a target="_blank" href="https://beian.mps.gov.cn/#/query/webSearch?code=xxx"><img loading="lazy" decoding="async" data-src="/assets/wangan.png" style="max-width:2em;display:inline" width="20" height="20" alt="备案">湘 ICP 备 2022002072 号</a></span></div></div></footer></div><script data-config type="text/javascript">var LOCAL = {
    ispost: true,
        path: `posts/3192084428.html`,
        favicon: {
        show: `（●´3｀●）やれやれだぜ`,
        hide: `(´Д｀)大変だ！`
    },
    search: {
        placeholder: "文章搜索",
        empty: "关于 「 ${query} 」，什么也没搜到",
        stats: "${time} ms 内找到 ${hits} 条结果"
    },
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">文章时效性提示</span><br>这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。</p></div>`,
    quiz: {
        choice: `单选题`,
        multiple: `多选题`,
        true_false: `判断题`,
        essay: `问答题`,
        gap_fill: `填空题`,
        mistake: `错题备注`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};</script><script src="https://s4.zstatic.net/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous" fetchpriority="high"></script><script src="https://s4.zstatic.net/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha384-ZvpUoO&#x2F;+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn&#x2F;6Z&#x2F;hRTt8+pR6L4N2" crossorigin="anonymous" fetchpriority="high"></script><script src="/js/siteInit.js?v=0.4.17" type="module" fetchpriority="high" defer></script></body></html><!-- rebuild by hrmmi -->